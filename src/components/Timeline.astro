---
import { Image } from 'astro:assets';

import facultadeMatematicas from '../assets/img/facultade_matematicas.jpg';
import uscLogo from '../assets/img/USC_logo.png';
import lodzLogo from '../assets/img/lodz_logo.png';
import ucmImage from '../assets/img/ucm.jpg';
import ucmLogo from '../assets/img/UCM_logo.svg';
import indraOffice from '../assets/img/indra_office.jpg';
import itxOffice from '../assets/img/itx_office.jpg';
import minsaitLogo from '../assets/img/minsait_logo.jpeg';
import indraLogo from '../assets/img/indra_logo.jpg';
import itxLogo from '../assets/img/itx_logo.png';
---

<section id="timeline" class="timeline-section">
  <div class="container">
    <div class="section-header">
      <h2 class="section-title">My Journey</h2>
      <p class="section-subtitle">Professional and academic steps</p>
    </div>

    <div class="timeline-container">
      <div class="timeline-layout">
      <div class="timeline-line-container">
        <div class="timeline-line-base"></div>
        <div class="timeline-line-progress"></div>
        
        <div class="timeline-dot" data-step="0" data-year="2017-2021">
          <div class="dot-inner education">
            <Image src={uscLogo} alt="USC Logo" class="dot-logo" width={100} height={100} format="webp" quality={100} loading="eager" />
          </div>
        </div>
        
        <div class="timeline-dot" data-step="1" data-year="2021-2022">
          <div class="dot-inner education">
            <Image src={ucmLogo} alt="UCM Logo" class="dot-logo" width={100} height={100} format="webp" quality={100} loading="eager" />
          </div>
        </div>
        
        <div class="timeline-dot" data-step="2" data-year="2021-2023">
          <div class="dot-inner work">
            <Image src={minsaitLogo} alt="Minsait Logo" class="dot-logo" width={100} height={100} format="webp" quality={100} loading="eager" />
          </div>
        </div>
        
        <div class="timeline-dot" data-step="3" data-year="2023-Today">
          <div class="dot-inner work current">
            <Image src={minsaitLogo} alt="Minsait Logo" class="dot-logo" width={100} height={100} format="webp" quality={100} loading="eager" />
          </div>
        </div>
      </div>

      <div class="timeline-content-area">
        
        <div class="timeline-step" data-step="0">
          <div class="step-card">
            <div class="card-header">
              <div class="date-badge">2017 - 2021</div>
              <div class="institution-logos">
                <Image src={uscLogo} alt="USC Logo" class="institution-logo" width={100} height={100} format="webp" quality={100} loading="eager" />
                <Image src={lodzLogo} alt="Lodz University Logo" class="institution-logo" width={100} height={100} format="webp" quality={100} loading="eager" />
              </div>
            </div>
            
            <div class="card-content">
              <h3 class="step-title">Mathematics</h3>
              <p class="step-institution">Universidade de Santiago de Compostela</p>
              
              <div class="step-image-container">
                <div class="image-section">
                  <Image src={facultadeMatematicas} alt="Facultad de Matemáticas" class="content-image" width={1200} height={900} format="webp" quality={100} loading="eager" />
                </div>
                <div class="image-text-section">
                  <p class="text-full">The Mathematics degree program develops strong analytical and problem-solving skills through the study of pure and applied mathematical concepts. Students explore calculus, algebra, statistics, and mathematical modeling, preparing them for careers in finance, technology, research, education, and data science</p>
                  <p class="text-mobile">Strong analytical and problem-solving skills through pure and applied mathematics. Focus on calculus, algebra, statistics, and mathematical modeling.</p>
                </div>
              </div>
              
              <div class="step-achievements">
                <div class="achievement">
                  <span class="achievement-label">Average Grade:</span>
                  <span class="achievement-value">8.4</span>
                </div>
                <div class="achievement">
                  <span class="achievement-label">Final Project:</span>
                  <span class="achievement-value">Computational Geometry</span>
                </div>
              </div>
            </div>
          </div>
        </div>

        <div class="timeline-step" data-step="1">
          <div class="step-card">
            <div class="card-header">
              <div class="date-badge">2021 - 2022</div>
              <div class="institution-logos">
                <Image src={ucmLogo} alt="UCM Logo" class="institution-logo" width={100} height={100} format="webp" quality={100} loading="eager" />
              </div>
            </div>
            
            <div class="card-content">
              <h3 class="step-title">Big Data & Data Science Máster</h3>
              <p class="step-institution">Universidad Complutense de Madrid</p>
              
              <div class="step-image-container">
                <div class="image-section">
                  <Image src={ucmImage} alt="UCM Campus" class="content-image" width={1200} height={900} format="webp" quality={100} loading="eager" />
                </div>
                <div class="image-text-section">
                  <p class="text-full">Advanced specialization in Big Data technologies and Data Science methodologies. Focused on machine learning algorithms, distributed computing, and statistical analysis with real-world applications in recommendation systems.</p>
                  <p class="text-mobile">Specialization in Big Data and Data Science. Machine learning, distributed computing, and statistical analysis.</p>
                </div>
              </div>
              
              <div class="step-achievements">
                <div class="achievement">
                  <span class="achievement-label">Average Grade:</span>
                  <span class="achievement-value">8.2</span>
                </div>
                <div class="achievement">
                  <span class="achievement-label">Final Project:</span>
                  <span class="achievement-value">KKBox Music Recommendation Challenge</span>
                </div>
              </div>
            </div>
          </div>
        </div>

        <div class="timeline-step" data-step="2">
          <div class="step-card">
            <div class="card-header">
              <div class="date-badge">2021 - 2023</div>
              <div class="institution-logos">
                <Image src={minsaitLogo} alt="Minsait Logo" class="institution-logo" width={100} height={100} format="webp" quality={100} loading="eager" />
                <Image src={indraLogo} alt="Indra Logo" class="institution-logo" width={100} height={100} format="webp" quality={100} loading="eager" />
                <Image src={itxLogo} alt="Inditex Logo" class="institution-logo" width={100} height={100} format="webp" quality={100} loading="eager" />
              </div>
            </div>
            
            <div class="card-content">
              <h3 class="step-title">Data Analyst</h3>
              <p class="step-institution">Indra • Minsait</p>
              
              <div class="step-image-container">
                <div class="image-section">
                  <Image src={indraOffice} alt="Indra Office" class="content-image" width={1200} height={900} format="webp" quality={100} loading="eager" />
                </div>
                <div class="image-text-section">
                  <p class="text-full">Business Intelligence and financial reporting, with proven expertise in developing and migrating reporting solutions across multiple platforms. Skilled in PowerBI, SSRS, and SQL with hands-on experience managing data migrations between DB2, Oracle, and Snowflake databases.</p>
                  <p class="text-mobile">Business Intelligence and financial reporting. PowerBI, SSRS, SQL with data migrations across DB2, Oracle, and Snowflake.</p>
                </div>
              </div>
              
              <div class="step-achievements">
                <div class="achievement">
                  <span class="achievement-label">Key Skills:</span>
                  <span class="achievement-value">PowerBI, SSRS, SQL</span>
                </div>
                <div class="achievement">
                  <span class="achievement-label">Technologies:</span>
                  <span class="achievement-value">DB2, Oracle, Snowflake</span>
                </div>
              </div>
            </div>
          </div>
        </div>

        <div class="timeline-step" data-step="3">
          <div class="step-card">
            <div class="card-header">
              <div class="date-badge">2023 - Today</div>
              <div class="institution-logos">
                <Image src={minsaitLogo} alt="Minsait Logo" class="institution-logo" width={100} height={100} format="webp" quality={100} loading="eager" />
                <Image src={indraLogo} alt="Indra Logo" class="institution-logo" width={100} height={100} format="webp" quality={100} loading="eager" />
                <Image src={itxLogo} alt="Inditex Logo" class="institution-logo" width={100} height={100} format="webp" quality={100} loading="eager" />
              </div>
            </div>
            
            <div class="card-content">
              <h3 class="step-title">Data Consultant</h3>
              <p class="step-institution">Indra • Minsait</p>
              
              <div class="step-image-container">
                <div class="image-section">
                  <Image src={itxOffice} alt="Inditex Office" class="content-image" width={1200} height={900} format="webp" quality={100} loading="eager" />
                </div>
                <div class="image-text-section">
                  <p class="text-full">MAGI-C project for Inditex, developing gross margin calculations and stock valuations from multiple corporate perspectives. Building complex SQL procedures in Snowflake for data processing and orchestration, while creating Power BI solutions and maintaining direct client relationships.</p>
                  <p class="text-mobile">MAGI-C project for Inditex: gross margin calculations and stock valuations. Complex SQL procedures in Snowflake and Power BI solutions.</p>
                </div>
              </div>
              
              <div class="step-achievements">
                <div class="achievement">
                  <span class="achievement-label">Key Skills:</span>
                  <span class="achievement-value">Snowflake SQL, Power BI</span>
                </div>
                <div class="achievement">
                  <span class="achievement-label">Technical Scope:</span>
                  <span class="achievement-value">SQL procedure development & validation systems</span>
                </div>
              </div>
            </div>
          </div>
        </div>

      </div>
    </div>
    </div>
  </div>
</section>

<style>
  .timeline-section {
    padding: 120px 0;
    position: relative;
    overflow: hidden;
  }

  .container {
    max-width: 1200px;
    margin: 0 auto;
    padding: 0 20px;
    position: relative;
    z-index: 1;
  }

  .section-header {
    text-align: center;
    margin-bottom: 80px;
    opacity: 0;
    transform: translateY(30px);
    animation: fadeInUp 0.8s ease-out 0.2s forwards;
  }

  .section-title {
    font-size: 3.5rem;
    font-weight: 800;
    margin-bottom: 20px;
    background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
    -webkit-background-clip: text;
    background-clip: text;
    -webkit-text-fill-color: transparent;
    text-shadow: 0 0 30px rgba(79, 172, 254, 0.3);
  }

  .section-subtitle {
    font-size: 1.2rem;
    color: #b0b0b0;
    max-width: 600px;
    margin: 0 auto;
    line-height: 1.6;
  }

  .timeline-container {
    max-width: 1400px;
    height: calc(100vh - 120px);
    margin: 0 auto;
    padding: 1rem;
    position: relative;
  }

  .timeline-layout {
    display: flex;
    width: 100%;
    height: 100%;
    gap: 1.5rem;
    position: relative;
  }

  .timeline-line-container {
    width: 16%;
    height: 100%;
    position: relative;
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: space-between;
    padding: 2rem 0.8rem;
    background: linear-gradient(135deg, 
      rgba(79, 172, 254, 0.1) 0%, 
      rgba(0, 242, 254, 0.05) 50%, 
      rgba(255, 107, 107, 0.1) 100%);
    border: 1px solid rgba(79, 172, 254, 0.3);
    border-radius: 20px;
    box-shadow: 0 10px 30px rgba(79, 172, 254, 0.2);
    backdrop-filter: blur(20px);
    overflow: hidden;
  }

  .timeline-line-container::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background: linear-gradient(45deg, transparent 30%, rgba(79, 172, 254, 0.05) 50%, transparent 70%);
    animation: shimmer 3s ease-in-out infinite;
    pointer-events: none;
  }

  .timeline-line-base {
    position: absolute;
    left: 50%;
    top: calc(2rem + 6vh); /* Ajustado para que empiece en el centro del primer dot */
    width: 2px;
    height: calc(100% - 4rem - 12vh); /* Reducido para que no exceda el último dot */
    background: rgba(79, 172, 254, 0.15);
    transform: translateX(-50%);
    z-index: 1;
    border-radius: 1px;
  }

  .timeline-dot {
    position: relative;
    z-index: 10;
    margin: 0;
    flex: 1;
    display: flex;
    align-items: center;
    justify-content: center;
    opacity: 1;
    cursor: pointer;
    transition: transform 0.3s ease;
  }

  .timeline-dot:hover {
    transform: scale(1.05);
  }

  .timeline-dot:hover .dot-inner {
    box-shadow: 0 0 25px rgba(79, 172, 254, 0.6);
  }

  .dot-inner {
    width: 8vh;
    height: 8vh;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    border: 2px solid rgba(255, 255, 255, 0.2);
    transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
    position: relative;
    overflow: hidden;
    background: rgba(255, 255, 255, 0.05);
  }

  .dot-inner.education {
    background: linear-gradient(135deg, #4facfe, #00f2fe);
    box-shadow: 0 0 20px rgba(79, 172, 254, 0.6);
  }

  .dot-inner.work {
    background: linear-gradient(135deg, #1d4ed8, #1e40af);
    box-shadow: 0 0 20px rgba(29, 78, 216, 0.6);
  }

  .dot-inner.current {
    background: linear-gradient(135deg, #1d4ed8, #1e40af);
    box-shadow: 0 0 25px rgba(29, 78, 216, 0.8);
  }

  .timeline-dot.active .dot-inner {
    box-shadow: 0 0 30px rgba(79, 172, 254, 0.8);
    border-color: rgba(79, 172, 254, 1);
    transform: scale(1.15);
  }

  /* Anillo indicador de progreso animado */
  .timeline-dot::before {
    content: '';
    position: absolute;
    width: calc(8vh + 16px);
    height: calc(8vh + 16px);
    border-radius: 50%;
    border: 2px solid transparent;
    opacity: 0;
    transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
    pointer-events: none;
  }

  .timeline-dot.active::before {
    opacity: 1;
    border-color: rgba(79, 172, 254, 0.6);
    animation: pulse-ring 2s ease-in-out infinite;
  }

  /* Segundo anillo para efecto de pulso */
  .timeline-dot::after {
    content: '';
    position: absolute;
    width: calc(8vh + 24px);
    height: calc(8vh + 24px);
    border-radius: 50%;
    border: 1px solid transparent;
    opacity: 0;
    transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
    pointer-events: none;
  }

  .timeline-dot.active::after {
    opacity: 1;
    border-color: rgba(79, 172, 254, 0.3);
    animation: pulse-ring 2s ease-in-out infinite 0.5s;
  }

  @keyframes pulse-ring {
    0%, 100% {
      transform: scale(1);
      opacity: 0.6;
    }
    50% {
      transform: scale(1.1);
      opacity: 0.3;
    }
  }

  /* Línea de progreso que conecta los dots */
  .timeline-line-progress {
    position: absolute;
    left: 50%;
    top: calc(2rem + 6vh);
    width: 3px;
    height: 0;
    background: linear-gradient(180deg, #4facfe 0%, #00f2fe 100%);
    transform: translateX(-50%);
    z-index: 2;
    border-radius: 2px;
    transition: height 0.6s cubic-bezier(0.4, 0, 0.2, 1);
    box-shadow: 0 0 10px rgba(79, 172, 254, 0.5);
  }

  .dot-logo {
    width: 6.5vh;
    height: 6.5vh;
    object-fit: contain;
    border-radius: 50%;
    background: white;
    padding: 0.3vh;
  }

  .timeline-content-area {
    width: 82.5%;
    height: 100%;
    position: relative;
    background: linear-gradient(135deg, 
      rgba(79, 172, 254, 0.1) 0%, 
      rgba(0, 242, 254, 0.05) 50%, 
      rgba(255, 107, 107, 0.1) 100%);
    border: 1px solid rgba(79, 172, 254, 0.3);
    border-radius: 20px;
    box-shadow: 0 10px 30px rgba(79, 172, 254, 0.2);
    backdrop-filter: blur(20px);
    overflow: hidden;
  }

  .timeline-content-area::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background: linear-gradient(45deg, transparent 30%, rgba(79, 172, 254, 0.05) 50%, transparent 70%);
    animation: shimmer 3s ease-in-out infinite;
    pointer-events: none;
    z-index: 1;
  }

  .timeline-content-area {
    overflow-y: auto;
    scroll-behavior: auto;
    scroll-snap-type: y mandatory;
    touch-action: pan-y;
    overscroll-behavior-y: contain;
    -webkit-overflow-scrolling: touch;
    scrollbar-width: thin;
    scrollbar-color: rgba(79, 172, 254, 0.4) transparent;
  }

  @keyframes shimmer {
    0%, 100% { opacity: 0; }
    50% { opacity: 1; }
  }

  /* Scrollbar moderna y minimalista */
  .timeline-content-area::-webkit-scrollbar {
    width: 6px;
  }

  .timeline-content-area::-webkit-scrollbar-track {
    background: transparent;
    margin: 10px 0;
  }

  .timeline-content-area::-webkit-scrollbar-thumb {
    background: linear-gradient(180deg, 
      rgba(79, 172, 254, 0.6) 0%, 
      rgba(0, 242, 254, 0.4) 100%);
    border-radius: 10px;
    border: 1px solid rgba(79, 172, 254, 0.2);
    box-shadow: 0 0 8px rgba(79, 172, 254, 0.3);
  }

  .timeline-content-area::-webkit-scrollbar-thumb:hover {
    background: linear-gradient(180deg, 
      rgba(79, 172, 254, 0.8) 0%, 
      rgba(0, 242, 254, 0.6) 100%);
    box-shadow: 0 0 12px rgba(79, 172, 254, 0.5);
  }

  .timeline-step {
    height: 100%;
    width: 100%;
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: flex-start;
    padding: 2vh;
    scroll-snap-align: start;
    opacity: 0.6;
    transition: opacity 0.5s ease;
    overflow-y: hidden;
    box-sizing: border-box;
    position: relative;
    z-index: 2;
  }

  .timeline-step.active {
    opacity: 1;
  }

  .step-card {
    width: 100%;
    height: 100%;
    margin: 0;
    padding: 1.5vh;
    background: transparent;
    border: none;
    border-radius: 0;
    box-shadow: none;
    backdrop-filter: none;
    display: flex;
    flex-direction: column;
    justify-content: space-between;
    overflow: hidden;
    box-sizing: border-box;
    position: relative;
  }

  .step-card:hover {
    transform: none;
    border-color: none;
    box-shadow: none;
  }

  .card-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 1vh;
    padding: 0 1vw;
    flex-shrink: 0;
    width: 100%;
    height: 6vh;
  }

  .date-badge {
    background: linear-gradient(135deg, #4facfe, #00f2fe);
    color: #000;
    font-size: 2.2vh;
    font-weight: 700;
    padding: 1vh 2vw;
    border-radius: 14px;
    text-transform: uppercase;
    letter-spacing: 0.05em;
  }

  .institution-logos {
    display: flex;
    gap: 1vw;
  }

  .institution-logo {
    width: 6vh;
    height: 6vh;
    object-fit: contain;
    border-radius: 8px;
    background: rgba(255, 255, 255, 0.9);
    padding: 4px;
    transition: transform 0.3s ease;
    image-rendering: high-quality;
  }

  .institution-logo:hover {
    transform: scale(1.1);
  }

  .card-content {
    padding: 0 1vw;
    flex: 1;
    display: flex;
    flex-direction: column;
    justify-content: space-between;
    min-height: 0;
    width: 100%;
    gap: 0.5vh;
    overflow: hidden; /* Sin scroll interno */
  }

  .step-image-container {
    margin: 0.5vh 0;
    border-radius: 12px;
    overflow: hidden;
    box-shadow: 0 8px 20px rgba(0, 0, 0, 0.4);
    flex: 1; /* Flexible para adaptarse al espacio disponible */
    min-height: 0; /* Permite que flex reduzca el tamaño */
    display: flex;
    gap: 1vh;
    padding: 1vh;
    background: rgba(255, 255, 255, 0.05);
    backdrop-filter: blur(10px);
    border: 1px solid rgba(79, 172, 254, 0.3);
  }

  .image-section {
    flex: 0 0 60%;
    height: 100%;
    overflow: hidden;
    border-radius: 8px;
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
    background: rgba(0, 0, 0, 0.2);
  }

  .image-text-section {
    flex: 0 0 38%;
    background: transparent;
    border-radius: 8px;
    padding: 1vh 1.5vh;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 2.6vh;
    color: #ffffff;
    line-height: 1.6;
    text-align: left;
    font-weight: 400;
  }

  .image-text-section p {
    margin: 0;
    font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', system-ui, sans-serif;
    text-shadow: 0 1px 2px rgba(0, 0, 0, 0.3);
  }

  .text-mobile {
    display: none !important; /* Oculto por defecto en escritorio */
  }
  
  .text-full {
    display: block !important; /* Visible por defecto en escritorio */
  }

  .content-image {
    width: 100%;
    height: 100%;
    object-fit: cover;
    transition: transform 0.4s ease;
    image-rendering: high-quality;
  }

  .step-card:hover .content-image {
    transform: scale(1.08);
  }

  .step-card:hover .image-section {
    box-shadow: 0 6px 18px rgba(0, 0, 0, 0.4);
  }

  /* Responsive para pantallas pequeñas */
  @media (max-width: 1024px) {
    .step-image-container {
      flex-direction: column;
      height: auto;
      gap: 1vh;
      padding: 1vh;
    }
    
    .image-section {
      flex: none;
      height: 20vh; /* AUMENTADO de 16vh a 18vh para mantener proporción */
    }
    
    .image-text-section {
      flex: none;
      padding: 1.5vh;
      font-size: 1.5vh;
      color: #c0c0c0;
      line-height: 1.8;
      font-weight: 400;
      min-height: 8vh;
    }
  }

  .step-title {
    font-size: 3.8vh;
    font-weight: 800;
    color: #ffffff;
    margin-bottom: 0.3vh;
    line-height: 1.1;
    flex-shrink: 0;
    background: linear-gradient(135deg, #ffffff 0%, #e0e0e0 100%);
    -webkit-background-clip: text;
    background-clip: text;
    -webkit-text-fill-color: transparent;
  }

  .step-institution {
    font-size: 2.4vh;
    color: #4facfe;
    font-weight: 500;
    margin-bottom: 0.3vh;
    flex-shrink: 0;
  }

  .step-description {
    font-size: 2.2vh;
    color: rgba(255, 255, 255, 0.8);
    line-height: 1.3;
    margin-bottom: 1vh;
    flex-shrink: 0;
  }

  .step-achievements {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(20vw, 1fr));
    gap: 0.8vh;
    margin-top: auto; /* Empuja al fondo */
    flex-shrink: 0;
    min-height: 8vh;
    max-height: 10vh;
  }

  .achievement {
    background: linear-gradient(135deg, 
      rgba(79, 172, 254, 0.1) 0%, 
      rgba(0, 242, 254, 0.05) 50%, 
      rgba(255, 107, 107, 0.1) 100%);
    border: 1px solid rgba(79, 172, 254, 0.3);
    border-radius: 8px;
    padding: 1vh 1.5vw;
    transition: all 0.3s ease;
    display: flex;
    flex-direction: column;
    justify-content: center;
    backdrop-filter: blur(10px);
    box-shadow: 0 4px 15px rgba(79, 172, 254, 0.1);
  }

  .achievement:hover {
    background: rgba(79, 172, 254, 0.08);
    border-color: rgba(79, 172, 254, 0.5);
    transform: translateY(-2px);
    box-shadow: 0 8px 20px rgba(79, 172, 254, 0.2);
  }

  .achievement-label {
    display: block;
    font-size: 1.5vh;
    color: rgba(255, 255, 255, 0.6);
    text-transform: uppercase;
    letter-spacing: 0.05em;
    margin-bottom: 0.5vh;
    font-weight: 400;
    font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', system-ui, sans-serif;
  }

  .achievement-value {
    display: block;
    font-size: 2.1vh;
    color: #ffffff;
    font-weight: 500;
    line-height: 1.2;
    font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', system-ui, sans-serif;
  }

  @media (max-width: 1200px) {
    .timeline-header {
      margin-bottom: 2.5rem;
      padding: 1.5rem 1rem;
    }
    
    .dot-inner {
      width: 7vh;
      height: 7vh;
    }
    
    .dot-logo {
      width: 5.6vh;
      height: 5.6vh;
    }

    .timeline-dot::before {
      width: calc(7vh + 14px);
      height: calc(7vh + 14px);
    }

    .timeline-dot::after {
      width: calc(7vh + 20px);
      height: calc(7vh + 20px);
    }
  }

  /* Media query específica para laptops (1024px - 1440px) */
  @media (max-width: 1440px) and (min-width: 1025px) {
    .step-title {
      font-size: 3.2vh;
    }

    .step-institution {
      font-size: 2vh;
    }

    .image-text-section {
      font-size: 2.2vh;
      padding: 1vh 1.2vh;
    }

    .achievement-label {
      font-size: 1.3vh;
    }

    .achievement-value {
      font-size: 1.8vh;
    }
  }

  @media (max-width: 1024px) {
    .timeline-header {
      margin-bottom: 2rem;
      padding: 1.5rem 0.8rem;
    }
    
    .step-image-container {
      flex-direction: column;
      gap: 1vh;
      padding: 1vh;
    }
    
    .image-section {
      flex: 2;
      min-height: 0;
    }
    
    .image-text-section {
      flex: 1;
      padding: 1.2vh;
      font-size: 1.8vh;
      color: #ffffff;
      line-height: 1.5;
      font-weight: 400;
    }
    
    .step-achievements {
      min-height: 7vh;
      max-height: 9vh;
    }
    
    .dot-inner {
      width: 6vh;
      height: 6vh;
    }
    
    .dot-logo {
      width: 4.8vh;
      height: 4.8vh;
    }

    .timeline-dot::before {
      width: calc(6vh + 12px);
      height: calc(6vh + 12px);
    }

    .timeline-dot::after {
      width: calc(6vh + 18px);
      height: calc(6vh + 18px);
    }
  }

  @media (max-width: 768px) {
    .timeline-section {
      padding: 80px 0;
    }
    
    .section-title {
      font-size: 2.5rem;
    }
    
    .section-subtitle {
      font-size: 1.2rem;
    }
    
    .timeline-container {
      flex-direction: column;
      gap: 1rem;
    }
    
    .timeline-layout {
      flex-direction: column;
      gap: 1rem;
    }
    
    .timeline-line-container {
      width: 100%;
      height: 80px;
      flex-direction: row;
      justify-content: space-between;
    }
    
    .timeline-content-area {
      width: 100%;
      flex: 1;
    }
    
    .step-card {
      padding: 0.8vh !important;
    }
    
    .card-header {
      height: 4vh !important;
      margin-bottom: 0.5vh !important;
    }
    
    .date-badge {
      font-size: 1.4vh !important;
      padding: 0.5vh 1.5vw !important;
    }
    
    .institution-logo {
      width: 4vh !important;
      height: 4vh !important;
    }
    
    .step-title {
      font-size: 3.6vh !important;
      margin-bottom: 0.4vh !important;
    }
    
    .step-institution {
      font-size: 2.6vh !important;
      margin-bottom: 0.4vh !important;
    }
    
    .step-image-container {
      flex-direction: column;
      flex: 1 !important;
      min-height: 0 !important;
      margin: 0.8vh 0 !important;
      padding: 1vh !important;
    }
    
    .image-section {
      flex: 2 !important;
      min-height: 0 !important;
    }
    
    .image-text-section {
      flex: 1 !important;
      font-size: 2vh !important;
      color: #ffffff;
      line-height: 1.5 !important;
      font-weight: 400;
      padding: 1vh !important;
    }
    
    .text-mobile {
      display: block !important;
    }
    
    .text-full {
      display: none !important;
    }
    
    .step-achievements {
      min-height: 5vh !important;
      max-height: 7vh !important;
      gap: 0.5vh !important;
      margin-top: auto !important;
    }
    
    .achievement {
      padding: 0.5vh 1vw !important;
    }
    
    .achievement-label {
      font-size: 1.1vh !important;
      margin-bottom: 0.2vh !important;
    }
    
    .achievement-value {
      font-size: 1.4vh !important;
    }
    
    .card-content {
      padding: 0 0.5vw !important;
      gap: 0.5vh !important;
      overflow-y: hidden !important; /* Eliminar scroll interno */
    }
    
    .dot-inner {
      width: 5vh;
      height: 5vh;
    }
    
    .dot-logo {
      width: 4vh;
      height: 4vh;
    }
  }
  
  /* Media query para pantallas muy pequeñas - optimización extrema */
  @media (max-width: 480px) {
    .section-title {
      font-size: 2rem !important;
      margin-bottom: 6px !important;
    }
    
    .section-subtitle {
      font-size: 1.2rem !important;
    }
    
    .timeline-header {
      margin-bottom: 0.8rem !important;
      padding: 0.3rem !important;
    }
    
    .step-image-container {
      flex: 1 !important;
      min-height: 0 !important;
    }
    
    .step-title {
      font-size: 3.2vh !important;
    }
    
    .step-institution {
      font-size: 2.4vh !important;
    }
    
    .image-text-section {
      font-size: 1.8vh !important;
      line-height: 1.4 !important;
      padding: 0.8vh !important;
    }
    
    .text-mobile {
      display: block !important;
    }
    
    .text-full {
      display: none !important;
    }
    
    .step-achievements {
      height: 5vh !important;
    }
    
    .achievement-label {
      font-size: 1vh !important;
    }
    
    .achievement-value {
      font-size: 1.2vh !important;
    }
  }

  @keyframes fadeInUp {
    from {
      opacity: 0;
      transform: translateY(30px);
    }
    to {
      opacity: 1;
      transform: translateY(0);
    }
  }
</style>

<script>
  interface AnimeInstance {
    (params: any): any;
    timeline: (params: any) => any;
    stagger: (value: number, options?: any) => any;
  }

  declare const anime: AnimeInstance;

  const script = document.createElement('script');
  script.src = 'https://cdnjs.cloudflare.com/ajax/libs/animejs/3.2.1/anime.min.js';
  script.onload = initializeTimeline;
  document.head.appendChild(script);

  function initializeTimeline(): void {
    if (typeof anime === 'undefined') {
      console.error('anime.js no está cargado');
      return;
    }

    const timelineSteps = document.querySelectorAll('.timeline-step');
    const timelineDots = document.querySelectorAll('.timeline-dot');
    const contentArea = document.querySelector('.timeline-content-area') as HTMLElement;
    const sectionTitle = document.querySelector('.timeline-section .section-title') as HTMLElement;
    const sectionSubtitle = document.querySelector('.timeline-section .section-subtitle') as HTMLElement;
    
    let currentActiveStep = 0;
    const totalSteps = timelineSteps.length;

    anime.timeline({
      easing: 'easeOutExpo',
      duration: 1000
    })
    .add({
      targets: sectionTitle,
      opacity: [0, 1],
      translateY: [50, 0],
      delay: 200
    })
    .add({
      targets: sectionSubtitle,
      opacity: [0, 1],
      translateY: [30, 0],
      delay: 100
    }, '-=800');

    anime({
      targets: '.timeline-dot',
      opacity: [0, 1],
      scale: [0.5, 1],
      duration: 800,
      delay: 800,
      easing: 'easeOutElastic(1, .8)'
    });

    function activateStep(stepIndex: number): void {
      if (stepIndex === currentActiveStep) return;

      const prevStep = timelineSteps[currentActiveStep];
      const prevDot = timelineDots[currentActiveStep];
      if (prevStep) prevStep.classList.remove('active');
      if (prevDot) prevDot.classList.remove('active');

      currentActiveStep = stepIndex;
      const currentStep = timelineSteps[stepIndex];
      const currentDot = timelineDots[stepIndex];

      if (currentStep) currentStep.classList.add('active');
      if (currentDot) {
        currentDot.classList.add('active');
      }

      // Actualizar línea de progreso
      updateProgressLine(stepIndex);
    }

    // Función para actualizar la línea de progreso
    function updateProgressLine(stepIndex: number): void {
      const progressLine = document.querySelector('.timeline-line-progress') as HTMLElement;
      const dots = document.querySelectorAll('.timeline-dot');
      
      if (!progressLine || dots.length < 2) return;

      // Si estamos en el primer paso, la línea debe tener altura 0
      if (stepIndex === 0) {
        progressLine.style.height = '0px';
        return;
      }

      // Obtener las posiciones reales de los dots
      const firstDot = dots[0] as HTMLElement;
      const targetDot = dots[stepIndex] as HTMLElement;
      
      if (!firstDot || !targetDot) return;

      // Calcular la distancia entre el centro del primer dot y el centro del dot actual
      const firstDotRect = firstDot.getBoundingClientRect();
      const targetDotRect = targetDot.getBoundingClientRect();
      
      const progressHeight = targetDotRect.top - firstDotRect.top;
      
      progressLine.style.height = `${Math.max(0, progressHeight)}px`;
    }

    if (contentArea) {
      let isMoving = false;
      let scrollAccumulator = 0;
      const scrollThreshold = 150;
      
      const goToStep = (stepIndex: number) => {
        if (isMoving) return;
        
        const targetStep = Math.max(0, Math.min(totalSteps - 1, stepIndex));
        if (targetStep === currentActiveStep) return;
        
        isMoving = true;
        scrollAccumulator = 0;
        const scrollAmount = contentArea.clientHeight;
        
        contentArea.scrollTo({
          top: targetStep * scrollAmount,
          behavior: 'smooth'
        });
        
        activateStep(targetStep);
        
        setTimeout(() => {
          isMoving = false;
        }, 800);
      };

      // Hacer los dots clickeables para navegar directamente
      timelineDots.forEach((dot, index) => {
        (dot as HTMLElement).style.cursor = 'pointer';
        dot.addEventListener('click', () => {
          goToStep(index);
        });
      });
      
      const handleWheel = (e: WheelEvent) => {
        e.preventDefault();
        
        if (isMoving) return;
        
        scrollAccumulator += Math.abs(e.deltaY);
        
        if (scrollAccumulator >= scrollThreshold) {
          if (e.deltaY > 0) {
            goToStep(currentActiveStep + 1);
          } else if (e.deltaY < 0) {
            goToStep(currentActiveStep - 1);
          }
          scrollAccumulator = 0;
        }
        
        setTimeout(() => {
          if (!isMoving) {
            scrollAccumulator = 0;
          }
        }, 300);
      };
      
      contentArea.addEventListener('wheel', handleWheel, { passive: false });

      contentArea.addEventListener('keydown', (e) => {
        switch(e.key) {
          case 'ArrowDown':
          case 'PageDown':
            e.preventDefault();
            goToStep(currentActiveStep + 1);
            break;
          case 'ArrowUp':
          case 'PageUp':
            e.preventDefault();
            goToStep(currentActiveStep - 1);
            break;
          case 'Home':
            e.preventDefault();
            goToStep(0);
            break;
          case 'End':
            e.preventDefault();
            goToStep(totalSteps - 1);
            break;
        }
      });

      contentArea.setAttribute('tabindex', '0');
    }

    setTimeout(() => {
      activateStep(0);
      
      timelineSteps.forEach(step => {
        (step as HTMLElement).style.opacity = '1';
      });

      if (contentArea) {
        contentArea.scrollTo({ top: 0, behavior: 'instant' });
      }
    }, 1500);
  }
</script>
