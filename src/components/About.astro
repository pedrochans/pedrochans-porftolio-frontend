---
// Componente About con línea temporal
import { Image } from 'astro:assets';

// Importar todas las imágenes del timeline
import facultadeMatematicas from '../assets/img/facultade_matematicas.jpg';
import uscLogo from '../assets/img/USC_logo.png';
import lodzLogo from '../assets/img/lodz_logo.png';
import ucmImage from '../assets/img/ucm.jpg';
import ucmLogo from '../assets/img/UCM_logo.svg';
import indraOffice from '../assets/img/indra_office.jpg';
import itxOffice2 from '../assets/img/itx_office_2.jpg';
import minsaitLogo from '../assets/img/minsait_logo.jpeg';
import indraLogo from '../assets/img/indra_logo.jpg';
import itxLogo from '../assets/img/itx_logo.png';
import itxOffice from '../assets/img/itx_office.jpg';
import indraGroup from '../assets/img/indra_group.jpg';
---

<section id="about" class="about">
  <div class="about-container">
    <div class="about-header">
      <h2 class="section-title">
        <span class="text-gradient">My Journey</span>
      </h2>
      <p class="section-subtitle">
        A timeline of my professional and academic experience
      </p>
    </div>

    <div class="timeline">
      <!-- Línea central base -->
      <div class="timeline-line-base"></div>
      <!-- Línea central que se rellena con scroll -->
      <div class="timeline-line-progress"></div>

      <!-- Educación - Izquierda -->
      <div class="timeline-item left" data-aos="fade-right" data-aos-delay="100">
        <!-- Imagen única centrada para cards 1-2 -->
        <div class="timeline-single-image left-side">
          <Image src={facultadeMatematicas} alt="Education Image" class="timeline-img" width={350} height={180} format="webp" quality={80} loading="lazy" />
        </div>
        
        <div class="timeline-marker education" data-marker="1">
          <Image src={uscLogo} alt="USC Logo" class="logo-full" width={90} height={90} format="webp" quality={90} loading="lazy" />
        </div>
        <!-- Círculos adicionales para múltiples logos -->
        <div class="additional-circles">
          <div class="additional-circle circle-1 education">
            <Image src={lodzLogo} alt="Lodz University Logo" class="logo-full" width={90} height={90} format="webp" quality={90} loading="lazy" />
          </div>
        </div>
        <div class="timeline-content">
          <div class="timeline-date">2017 - 2021</div>
          <div class="timeline-institution">
            <h3>Grado en Matemáticas</h3>
            <p class="institution-names">Universidade de Santiago de Compostela • Lodz University</p>
            <ul class="achievements">
              <li>Average grade of the record: 8.4</li>
              <li>TFG: Computational Geometry</li>
            </ul>
          </div>
        </div>
      </div>

      <!-- Máster - Derecha -->
      <div class="timeline-item right" data-aos="fade-left" data-aos-delay="200">
        <!-- Imagen única centrada para cards 1-2 -->
        <div class="timeline-single-image right-side">
          <Image src={ucmImage} alt="Master Image" class="timeline-img" width={350} height={180} format="webp" quality={80} loading="lazy" />
        </div>
        
        <div class="timeline-marker education" data-marker="2">
          <Image src={ucmLogo} alt="UCM Logo" class="logo-full" width={90} height={90} format="webp" quality={90} loading="lazy" />
        </div>
        <div class="timeline-content">
          <div class="timeline-date">2021 - 2022</div>
          <div class="timeline-institution">
            <h3>Máster en Big Data & Data Science</h3>
            <p class="institution-names">Universidad Complutense de Madrid</p>
            <ul class="achievements">
              <li>Average grade of the record: 8.2</li>
              <li>TFM: KKBox Music Recommendation Challenge</li>
            </ul>
          </div>
        </div>
      </div>

      <!-- Data Analyst - Izquierda -->
      <div class="timeline-item left" data-aos="fade-right" data-aos-delay="300">
        <!-- Grupo de imágenes para cards 3-4 -->
        <div class="timeline-image-group left-side">
          <div class="timeline-group-image first">
            <Image src={indraOffice} alt="Data Analyst Image" class="timeline-img" width={350} height={180} format="webp" quality={80} loading="lazy" />
          </div>
          <div class="timeline-group-image second">
            <Image src={itxOffice2} alt="Snowflake Technology" class="timeline-img" width={350} height={180} format="webp" quality={80} loading="lazy" />
          </div>
        </div>
        
        <div class="timeline-marker work" data-marker="3">
          <Image src={minsaitLogo} alt="Minsait Logo" class="logo-full" width={90} height={90} format="webp" quality={90} loading="lazy" />
        </div>
        <!-- Círculos adicionales para múltiples logos -->
        <div class="additional-circles">
          <div class="additional-circle circle-1 work">
            <Image src={indraLogo} alt="Indra Logo" class="logo-full" width={90} height={90} format="webp" quality={90} loading="lazy" />
          </div>
          <div class="additional-circle circle-2 work">
            <Image src={itxLogo} alt="Inditex Logo" class="logo-full" width={90} height={90} format="webp" quality={90} loading="lazy" />
          </div>
        </div>
        <div class="timeline-content">
          <div class="timeline-date">2021 - 2023</div>
          <div class="timeline-institution">
            <h3>Data Analyst</h3>
            <p class="institution-names">Indra • Minsait</p>
            <p class="role-description">Business Intelligence and financial reporting</p>
            <ul class="achievements">
              <li>Development and restyling of reports in PowerBI, SSRS</li>
              <li>Migrating data and SQL procedures to DB2, Oracle, and Snowflake</li>
            </ul>
          </div>
        </div>
      </div>

      <!-- Data Consultant - Derecha -->
      <div class="timeline-item right" data-aos="fade-left" data-aos-delay="400">
        <!-- Grupo de imágenes para cards 3-4 -->
        <div class="timeline-image-group right-side">
          <div class="timeline-group-image first">
            <Image src={itxOffice} alt="Data Consultant Image" class="timeline-img" width={350} height={180} format="webp" quality={80} loading="lazy" />
          </div>
          <div class="timeline-group-image second">
            <Image src={indraGroup} alt="Microsoft Technology" class="timeline-img" width={350} height={180} format="webp" quality={80} loading="lazy" />
          </div>
        </div>
        
        <div class="timeline-marker work current" data-marker="4">
          <Image src={minsaitLogo} alt="Minsait Logo" class="logo-full" width={90} height={90} format="webp" quality={90} loading="lazy" />
        </div>
        <!-- Círculos adicionales para múltiples logos -->
        <div class="additional-circles">
          <div class="additional-circle circle-1 work">
            <Image src={indraLogo} alt="Indra Logo" class="logo-full" width={90} height={90} format="webp" quality={90} loading="lazy" />
          </div>
          <div class="additional-circle circle-2 current">
            <Image src={itxLogo} alt="Inditex Logo" class="logo-full" width={90} height={90} format="webp" quality={90} loading="lazy" />
          </div>
        </div>
        <div class="timeline-content">
          <div class="timeline-date">2023 - Today</div>
          <div class="timeline-institution">
            <h3>Data Consultant</h3>
            <p class="institution-names">Indra • Minsait</p>
            <p class="role-description">MAGI-C Project: Calculation of Gross Margin and Valuation of Inditex's Stock with different corporate perspectives of the company</p>
            <ul class="achievements">
              <li>Developing SQL procedures in Snowflake. Calculation, data processing, task scheduling, orchestration, controls, and validation</li>
              <li>Power BI development, integration with the frontend of the calculation application.</li>
              <li>Communication and problem resolution in direct contact with the end customer</li>
            </ul>
          </div>
        </div>
      </div>
    </div>
  </div>
</section>

<style>
  .about {
    min-height: 100vh;
    padding: 5rem 2rem;
    position: relative;
    /* Sin background aquí - se movió al contenedor */
  }

  .about-container {
    max-width: 1400px;
    margin: 0 auto;
    position: relative;
    background: linear-gradient(135deg, 
      rgba(12, 20, 39, 0.95) 0%, 
      rgba(30, 41, 59, 0.95) 50%, 
      rgba(12, 20, 39, 0.95) 100%
    );
    backdrop-filter: blur(20px);
    border-radius: 24px;
    padding: 4rem 3rem;
    border: 1px solid rgba(255, 255, 255, 0.1);
    box-shadow: 0 20px 40px rgba(0, 0, 0, 0.3);
  }

  .about-header {
    text-align: center;
    margin-bottom: 4rem;
  }

  .section-title {
    font-size: clamp(2.5rem, 6vw, 4rem);
    font-weight: 700;
    margin-bottom: 1rem;
    opacity: 0;
    transform: translateY(30px);
    animation: fadeInUp 0.8s ease-out 0.2s forwards;
  }

  .section-subtitle {
    font-size: clamp(1.1rem, 2.5vw, 1.3rem);
    color: var(--text-secondary);
    max-width: 600px;
    margin: 0 auto;
    opacity: 0;
    transform: translateY(30px);
    animation: fadeInUp 0.8s ease-out 0.4s forwards;
  }

  .timeline {
    position: relative;
    max-width: 1600px;
    margin: 0 auto;
    padding: 2rem 0;
  }

  .timeline-line-base {
    position: absolute;
    left: 50%;
    top: 0;
    width: 3px;
    background: rgba(59, 130, 246, 0.2);
    transform: translateX(-50%);
    z-index: -10;
  }

  .timeline-line-progress {
    position: absolute;
    left: 50%;
    top: 0;
    width: 3px;
    background: linear-gradient(180deg, 
      var(--accent-primary) 0%, 
      var(--accent-secondary) 50%, 
      var(--accent-primary) 100%
    );
    transform: translateX(-50%);
    z-index: -5;
    height: 0%;
    transition: height 0.5s ease-out;
  }

  .timeline-item {
    position: relative;
    margin: 4rem 0;
    opacity: 1;
    transform: translateY(0);
    display: flex;
    align-items: center;
    min-height: 200px;
    width: 100%;
  }

  .timeline-item[data-aos="fade-right"] {
    /* Animación removida - las cards permanecen fijas */
  }

  .timeline-item[data-aos="fade-left"] {
    /* Animación removida - las cards permanecen fijas */
  }

  /* Items a la izquierda */
  .timeline-item.left {
    justify-content: flex-start;
  }

  .timeline-item.left .timeline-content {
    margin-right: 3rem;
    text-align: right;
    margin-left: auto;
    width: 50%;
  }

  .timeline-item.left .timeline-marker {
    position: absolute;
    left: 50%;
    top: 50%;
    transform: translate(-50%, -50%);
    z-index: 100 !important;
  }

  /* Items a la derecha */
  .timeline-item.right {
    justify-content: flex-end;
  }

  .timeline-item.right .timeline-content {
    margin-left: 3rem;
    text-align: left;
    margin-right: auto;
    width: 50%;
  }

  .timeline-item.right .timeline-marker {
    position: absolute;
    left: 50%;
    top: 50%;
    transform: translate(-50%, -50%);
    z-index: 100 !important;
  }

  .timeline-marker {
    position: relative;
    left: 50%;
    top: 50%;
    transform: translate(-50%, -50%);
    width: 100px;
    height: 100px;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    z-index: 100 !important;
    transition: box-shadow 0.3s ease, border-color 0.3s ease;
    border: 3px solid rgba(255, 255, 255, 0.2);
  }

  .timeline-marker.education {
    background: linear-gradient(135deg, #2563eb, #1d4ed8);
    box-shadow: 0 0 30px rgba(37, 99, 235, 0.4);
  }

  .timeline-marker.work {
    background: linear-gradient(135deg, #2563eb, #1d4ed8);
    box-shadow: 0 0 30px rgba(37, 99, 235, 0.4);
  }

  .timeline-marker.current {
    background: linear-gradient(135deg, var(--accent-primary), var(--accent-secondary));
    box-shadow: 0 0 30px rgba(59, 130, 246, 0.5);
  }

  .timeline-marker.activated {
    box-shadow: 0 0 40px rgba(59, 130, 246, 0.6);
    border-color: rgba(59, 130, 246, 0.5);
  }

  .timeline-marker.spark-effect {
    animation: sparkBurst 0.8s ease-out;
  }

  /* ===== CÍRCULOS ADICIONALES ===== */
  .additional-circles {
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    z-index: 97;
    pointer-events: none;
    width: 300px;
    height: 100px;
  }

  .additional-circle {
    position: absolute;
    width: 80px;
    height: 80px;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    border: 3px solid rgba(255, 255, 255, 0.2);
    opacity: 0;
    scale: 0.3;
    transition: all 0.6s cubic-bezier(0.4, 0, 0.2, 1);
    z-index: 98;
  }

  /* Estilos de círculos adicionales según tipo */
  .additional-circle.education {
    background: linear-gradient(135deg, #2563eb, #1d4ed8);
    box-shadow: 0 0 30px rgba(37, 99, 235, 0.4);
  }

  .additional-circle.work {
    background: linear-gradient(135deg, #2563eb, #1d4ed8);
    box-shadow: 0 0 30px rgba(37, 99, 235, 0.4);
  }

  .additional-circle.current {
    background: linear-gradient(135deg, var(--accent-primary), var(--accent-secondary));
    box-shadow: 0 0 30px rgba(59, 130, 246, 0.5);
  }

  /* Posicionamiento inicial - comenzando desde el centro del timeline-marker */
  .timeline-item.left .additional-circle.circle-1 {
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
  }

  .timeline-item.left .additional-circle.circle-2 {
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
  }

  /* Posicionamiento para items derechos */
  .timeline-item.right .additional-circle.circle-1 {
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
  }

  .timeline-item.right .additional-circle.circle-2 {
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
  }

  /* Activación con animación hacia posiciones finales */
  .timeline-item.left .timeline-marker.activated ~ .additional-circles .additional-circle.circle-1 {
    opacity: 1;
    scale: 1;
    transform: translate(-145px, -50%);
    animation: slideFromCenter 0.8s cubic-bezier(0.4, 0, 0.2, 1) 0.3s both;
  }

  .timeline-item.left .timeline-marker.activated ~ .additional-circles .additional-circle.circle-2 {
    opacity: 1;
    scale: 1;
    transform: translate(-240px, -50%);
    animation: slideFromCenter 0.8s cubic-bezier(0.4, 0, 0.2, 1) 0.6s both;
  }

  .timeline-item.right .timeline-marker.activated ~ .additional-circles .additional-circle.circle-1 {
    opacity: 1;
    scale: 1;
    transform: translate(65px, -50%);
    animation: slideFromCenter 0.8s cubic-bezier(0.4, 0, 0.2, 1) 0.3s both;
  }

  .timeline-item.right .timeline-marker.activated ~ .additional-circles .additional-circle.circle-2 {
    opacity: 1;
    scale: 1;
    transform: translate(160px, -50%);
    animation: slideFromCenter 0.8s cubic-bezier(0.4, 0, 0.2, 1) 0.6s both;
  }

  /* Logos dentro de círculos adicionales */
  .additional-circle .logo-full {
    width: 85%;
    height: 85%;
    object-fit: contain;
    background: white;
    border-radius: 50%;
    padding: 2px;
    box-shadow: 0 2px 6px rgba(0, 0, 0, 0.2);
  }

  .marker-logos {
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    gap: 2px;
    position: relative;
    z-index: 11;
  }

  .logo-mini {
    background: rgba(255, 255, 255, 0.15);
    border-radius: 6px;
    padding: 3px 6px;
    font-size: 0.6rem;
    font-weight: 700;
    color: white;
    letter-spacing: 0.05em;
    text-shadow: 0 1px 2px rgba(0, 0, 0, 0.3);
    backdrop-filter: blur(10px);
    border: 1px solid rgba(255, 255, 255, 0.2);
    position: relative;
    z-index: 12;
  }

  .timeline-content {
    background: rgba(255, 255, 255, 0.03);
    backdrop-filter: blur(25px);
    border: 1px solid rgba(255, 255, 255, 0.08);
    border-radius: 20px;
    padding: 2.5rem;
    max-width: 520px;
    position: relative;
    transition: all 0.3s ease;
    min-height: 180px;
    box-shadow: 0 8px 32px rgba(0, 0, 0, 0.15);
  }

  .timeline-content:hover {
    transform: translateY(-5px);
    box-shadow: 0 20px 40px rgba(0, 0, 0, 0.2);
    border-color: rgba(59, 130, 246, 0.3);
  }

  .timeline-content.highlighted {
    border-color: rgba(59, 130, 246, 0.5);
    box-shadow: 0 0 30px rgba(59, 130, 246, 0.2);
    transform: translateY(-2px);
  }

  .timeline-date {
    display: inline-block;
    background: linear-gradient(135deg, var(--accent-primary), var(--accent-secondary));
    color: white;
    font-size: 0.75rem;
    font-weight: 700;
    padding: 0.4rem 0.8rem;
    border-radius: 20px;
    margin-bottom: 1.5rem;
    text-transform: uppercase;
    letter-spacing: 0.08em;
    box-shadow: 0 2px 8px rgba(59, 130, 246, 0.3);
  }

  .timeline-institution h3 {
    font-size: 2rem;
    color: var(--text-primary);
    margin-bottom: 1rem;
    font-weight: 700;
    line-height: 1.2;
    letter-spacing: -0.02em;
  }

  .institution-names {
    color: var(--accent-primary);
    font-size: 1.125rem;
    font-weight: 600;
    margin-bottom: 1.5rem;
    letter-spacing: 0.02em;
  }

  .role-description {
    color: var(--text-secondary);
    font-size: 0.95rem;
    line-height: 1.6;
    margin-bottom: 2rem;
    padding-bottom: 1.5rem;
    border-bottom: 1px solid rgba(255, 255, 255, 0.1);
    position: relative;
  }

  .achievements {
    list-style: none;
    padding: 0;
    margin: 0;
    display: flex;
    flex-direction: column;
    gap: 1rem;
  }

  .achievements li {
    position: relative;
    padding: 1rem 1rem 1rem 2rem;
    margin: 0;
    color: var(--text-secondary);
    line-height: 1.7;
    background: rgba(255, 255, 255, 0.02);
    border: 1px solid rgba(255, 255, 255, 0.05);
    border-radius: 8px;
    transition: all 0.3s ease;
    backdrop-filter: blur(10px);
    font-size: 0.94rem;
    font-weight: 400;
  }

  .achievements li:hover {
    background: rgba(59, 130, 246, 0.05);
    border-color: rgba(59, 130, 246, 0.15);
    transform: translateX(2px);
  }

  .achievements li::before {
    content: '';
    position: absolute;
    left: 0.75rem;
    top: 50%;
    transform: translateY(-50%);
    width: 6px;
    height: 6px;
    background: var(--accent-primary);
    border-radius: 50%;
    box-shadow: 0 0 8px rgba(59, 130, 246, 0.4);
  }

  .achievements li::after {
    display: none;
  }

  @keyframes fadeInUp {
    from {
      opacity: 0;
      transform: translateY(30px);
    }
    to {
      opacity: 1;
      transform: translateY(0);
    }
  }

  @keyframes fadeInRight {
    /* Animación deshabilitada para timeline-items */
    from, to {
      opacity: 1;
      transform: translateX(0);
    }
  }

  @keyframes fadeInLeft {
    /* Animación deshabilitada para timeline-items */
    from, to {
      opacity: 1;
      transform: translateX(0);
    }
  }



  @keyframes markerActivated {
    0% {
      box-shadow: 0 0 30px rgba(59, 130, 246, 0.4);
    }
    50% {
      box-shadow: 0 0 50px rgba(59, 130, 246, 0.8);
    }
    100% {
      box-shadow: 0 0 40px rgba(59, 130, 246, 0.6);
    }
  }

  @keyframes sparkBurst {
    0% {
      box-shadow: 
        0 0 30px rgba(59, 130, 246, 0.4),
        0 0 0 0 rgba(59, 130, 246, 0.7);
    }
    25% {
      box-shadow: 
        0 0 40px rgba(59, 130, 246, 0.6),
        0 0 10px 5px rgba(59, 130, 246, 0.4);
    }
    50% {
      box-shadow: 
        0 0 50px rgba(59, 130, 246, 0.8),
        0 0 20px 10px rgba(59, 130, 246, 0.2);
    }
    75% {
      box-shadow: 
        0 0 60px rgba(59, 130, 246, 0.6),
        0 0 30px 15px rgba(59, 130, 246, 0.1);
    }
    100% {
      box-shadow: 
        0 0 40px rgba(59, 130, 246, 0.6),
        0 0 0 0 rgba(59, 130, 246, 0);
    }
  }

  @keyframes slideFromCenter {
    0% {
      opacity: 0;
      scale: 0.3;
      transform: translate(-50%, -50%);
      box-shadow: 0 0 0 rgba(0, 0, 0, 0);
    }
    50% {
      opacity: 0.8;
      scale: 0.9;
      box-shadow: 0 0 15px rgba(0, 0, 0, 0.2);
    }
    100% {
      opacity: 1;
      scale: 1;
      box-shadow: 0 0 20px rgba(0, 0, 0, 0.3);
    }
  }

  /* Asegurar que el texto de los markers esté siempre visible */
  .timeline-marker * {
    position: relative;
    z-index: 101 !important;
  }

  .timeline-marker::before,
  .timeline-marker::after {
    z-index: -1 !important;
  }

  /* ===== SISTEMA DE IMÁGENES PARA TIMELINE ===== */
  
  /* 1. IMÁGENES ÚNICAS (Cards 1-2) - Centradas verticalmente */
  .timeline-single-image {
    position: absolute;
    width: 350px;
    height: 180px;
    z-index: 1;
    opacity: 0;
    pointer-events: none;
    top: 50%; /* Centrada verticalmente */
    transform: translateY(-50%) rotate(-2deg) scale(0.8);
    border-radius: 16px;
    overflow: hidden;
    backdrop-filter: blur(10px);
    border: 1px solid rgba(59, 130, 246, 0.3);
    box-shadow: 0 8px 32px rgba(0, 0, 0, 0.15);
    transition: all 0.6s cubic-bezier(0.4, 0, 0.2, 1);
  }

  /* Estado visible para imágenes únicas */
  .timeline-single-image.visible {
    opacity: 0.8;
    transform: translateY(-50%) rotate(0deg) scale(1);
  }

  /* Alternancia de rotación para imágenes únicas */
  .timeline-item:nth-child(even) .timeline-single-image {
    transform: translateY(-50%) rotate(2deg) scale(0.8);
  }

  .timeline-item:nth-child(even) .timeline-single-image.visible {
    transform: translateY(-50%) rotate(0deg) scale(1);
  }

  /* Posicionamiento por lado para imágenes únicas */
  .timeline-single-image.left-side {
    left: 8%;
  }

  .timeline-single-image.right-side {
    right: 8%;
  }

  /* 2. GRUPOS DE IMÁGENES (Cards 3-4) - Contenedor centrado con imágenes apiladas */
  .timeline-image-group {
    position: absolute;
    width: 350px;
    height: 400px; /* Altura suficiente para dos imágenes */
    z-index: 1;
    top: 50%; /* Contenedor centrado */
    transform: translateY(-50%);
    opacity: 0;
    transition: all 0.6s cubic-bezier(0.4, 0, 0.2, 1);
  }

  /* Estado visible para grupos de imágenes */
  .timeline-image-group.visible {
    opacity: 1;
  }

  /* Posicionamiento por lado para grupos */
  .timeline-image-group.left-side {
    left: 8%;
  }

  .timeline-image-group.right-side {
    right: 8%;
  }

  /* Imágenes individuales dentro del grupo */
  .timeline-group-image {
    position: absolute;
    width: 100%;
    height: 180px;
    border-radius: 16px;
    overflow: hidden;
    backdrop-filter: blur(10px);
    border: 1px solid rgba(59, 130, 246, 0.3);
    box-shadow: 0 8px 32px rgba(0, 0, 0, 0.15);
    opacity: 0;
    transition: all 0.6s cubic-bezier(0.4, 0, 0.2, 1);
  }

  /* Primera imagen del grupo */
  .timeline-group-image.first {
    top: 0;
    transform: rotate(-2deg) scale(0.8);
  }

  /* Segunda imagen del grupo */
  .timeline-group-image.second {
    top: 200px; /* Separada de la primera */
    transform: rotate(0deg) scale(0.8); /* Sin rotación inicial */
  }

  /* Estados visibles para imágenes del grupo */
  .timeline-image-group.visible .timeline-group-image.first {
    opacity: 0.8;
    transform: rotate(0deg) scale(1);
  }

  .timeline-image-group.visible .timeline-group-image.second {
    opacity: 0.8;
    transform: rotate(0deg) scale(1);
  }

  /* Alternancia para grupos en elementos pares */
  .timeline-item:nth-child(even) .timeline-group-image.first {
    transform: rotate(2deg) scale(0.8);
  }

  /* Estado visible para primera imagen en elementos pares */
  .timeline-item:nth-child(even) .timeline-image-group.visible .timeline-group-image.first {
    opacity: 0.8;
    transform: rotate(0deg) scale(1);
  }

  /* Estilos comunes para todas las imágenes */
  .timeline-img {
    width: 100%;
    height: 100%;
    object-fit: cover;
    filter: brightness(0.9) contrast(1.1);
  }

  /* RESPONSIVE PARA NUEVO SISTEMA */
  @media (max-width: 768px) {
    /* Imágenes únicas en tablets */
    .timeline-single-image {
      width: 250px;
      height: 160px;
    }

    /* Grupos de imágenes en tablets */
    .timeline-image-group {
      width: 250px;
      height: 340px;
    }

    .timeline-group-image {
      height: 150px;
    }

    .timeline-group-image.second {
      top: 170px;
    }
  }

  @media (max-width: 600px) {
    /* Ocultar todas las imágenes en móviles */
    .timeline-single-image,
    .timeline-image-group {
      display: none !important;
    }
  }

  .timeline-img {
    width: 100%;
    height: 100%;
    object-fit: cover;
    filter: brightness(0.9) contrast(1.1);
  }
    opacity: 1;
  }

  /* Overlay sutil para mejor integración */
  .timeline-image::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background: linear-gradient(135deg, 
      rgba(59, 130, 246, 0.1) 0%, 
      rgba(59, 130, 246, 0.05) 50%, 
      transparent 100%
    );
    z-index: 2;
    pointer-events: none;
  }

  /* Responsive */
  @media (max-width: 1200px) {
    .timeline-image {
      width: 280px;
      height: 180px;
      transform: translateY(-50%) rotate(-1.5deg) scale(0.8);
    }

    .timeline-image.visible {
      transform: translateY(-50%) rotate(-0.8deg) scale(1);
    }

    .timeline-item:nth-child(even) .timeline-image {
      transform: translateY(-50%) rotate(1.5deg) scale(0.8);
    }

    .timeline-item:nth-child(even) .timeline-image.visible {
      transform: translateY(-50%) rotate(0.8deg) scale(1);
    }

    .timeline-item:nth-child(odd):hover .timeline-image.visible {
      transform: translateY(-50%) rotate(-0.8deg) scale(1.02);
    }

    .timeline-item:nth-child(even):hover .timeline-image.visible {
      transform: translateY(-50%) rotate(0.8deg) scale(1.02);
    }

    .timeline-image.left-side {
      left: 8%;
    }

    .timeline-image.right-side {
      right: 8%;
    }
  }

  @media (max-width: 1024px) {
    .timeline-image {
      width: 240px;
      height: 150px;
      opacity: 0;
      transform: translateY(-50%) rotate(-1deg) scale(0.8);
    }

    .timeline-image.visible {
      opacity: 0.7;
      transform: translateY(-50%) rotate(-0.5deg) scale(1);
    }

    .timeline-item:nth-child(even) .timeline-image {
      transform: translateY(-50%) rotate(1deg) scale(0.8);
    }

    .timeline-item:nth-child(even) .timeline-image.visible {
      transform: translateY(-50%) rotate(0.5deg) scale(1);
    }

    .timeline-image.left-side {
      left: 8%;
    }

    .timeline-image.right-side {
      right: 8%;
    }
  }

  @media (max-width: 768px) {
    .about {
      padding: 2rem 1rem;
    }

    .about-container {
      padding: 2rem 1.5rem;
      border-radius: 16px;
    }

    /* Ocultar imágenes en mobile pero mostrar con rotación mayor para tablets */
    .timeline-image {
      width: 250px;
      height: 160px;
      transform: translateY(-50%) rotate(-3deg) scale(0.8);
    }

    .timeline-image.visible {
      transform: translateY(-50%) rotate(0deg) scale(1);
    }

    .timeline-item:nth-child(even) .timeline-image {
      transform: translateY(-50%) rotate(3deg) scale(0.8);
    }

    .timeline-item:nth-child(even) .timeline-image.visible {
      transform: translateY(-50%) rotate(0deg) scale(1);
    }

    /* Segundas imágenes en tablets - siempre derechas */
    .timeline-image.second-image {
      width: 250px; /* Mismo tamaño que la primera en tablets */
      height: 160px; /* Mismo tamaño que la primera en tablets */
      top: 65%; /* Mantener menor margen */
      transform: translateY(-50%) rotate(0deg) scale(0.8);
    }

    .timeline-image.second-image.visible {
      transform: translateY(-50%) rotate(0deg) scale(1);
    }
  }

  @media (max-width: 600px) {
    /* Ocultar completamente en pantallas muy pequeñas */
    .timeline-image {
      display: none !important;
    }

    .timeline-line-base,
    .timeline-line-progress {
      left: 30px;
    }

    .timeline-marker {
      left: 30px !important;
      width: 70px;
      height: 70px;
      transform: translate(-50%, -50%) !important;
    }

    .logo-mini {
      font-size: 0.4rem;
      padding: 1px 3px;
    }

    .logo-full {
      width: 90%;
      height: 90%;
      padding: 1px;
    }

    .timeline-item {
      justify-content: flex-start !important;
      margin: 2rem 0;
    }

    .timeline-content {
      width: calc(100% - 110px) !important;
      max-width: none !important;
      margin-left: 90px !important;
      margin-right: 0 !important;
      text-align: left !important;
      padding: 2rem 1.5rem;
    }

    .timeline-institution h3 {
      font-size: 1.5rem;
    }

    .institution-names {
      font-size: 1rem;
    }

    .timeline-date {
      font-size: 0.7rem;
      padding: 0.3rem 0.6rem;
    }

    .achievements li {
      font-size: 0.9rem;
      padding: 0.8rem 0.8rem 0.8rem 1.8rem;
    }

    .achievements li::before {
      left: 0.6rem;
      width: 5px;
      height: 5px;
    }

    /* Ocultar círculos adicionales en móvil y tablet */
    .additional-circles {
      display: none !important;
    }
  }

  /* Reduce motion for accessibility */
  @media (prefers-reduced-motion: reduce) {
    .section-title,
    .section-subtitle {
      animation: none;
      opacity: 1;
      transform: none;
    }

    .timeline-line {
      animation: none;
      opacity: 1;
    }

    .timeline-marker.current {
      animation: none;
    }

    .timeline-content:hover {
      transform: none;
    }
  }

  .logo-full {
    width: 90%;
    height: 90%;
    object-fit: contain;
    background: white;
    border-radius: 50%;
    padding: 2px;
    position: relative;
    z-index: 12;
    box-shadow: 0 2px 8px rgba(0, 0, 0, 0.2);
  }
</style>

<script>
  // Intersection Observer para animaciones y efecto de línea temporal discreto
  document.addEventListener('DOMContentLoaded', () => {
    const timelineItems = document.querySelectorAll('.timeline-item');
    const timelineProgress = document.querySelector('.timeline-line-progress') as HTMLElement;
    const timeline = document.querySelector('.timeline') as HTMLElement;
    const markers = document.querySelectorAll('.timeline-marker');
    
    let currentActivePoint = -1;
    let isAnimating = false;
    
    // Configurar animaciones de elementos (solo para headers, no para timeline-items)
    const observer = new IntersectionObserver((entries) => {
      entries.forEach((entry) => {
        if (entry.isIntersecting) {
          const element = entry.target as HTMLElement;
          
          // Solo animar elementos que NO sean timeline-item
          if (!element.classList.contains('timeline-item')) {
            const delay = element.getAttribute('data-aos-delay') || '0';
            const animationType = element.getAttribute('data-aos') || 'fade-up';
            
            setTimeout(() => {
              if (animationType === 'fade-right') {
                element.style.animation = 'fadeInRight 0.8s ease-out forwards';
              } else if (animationType === 'fade-left') {
                element.style.animation = 'fadeInLeft 0.8s ease-out forwards';
              } else {
                element.style.animation = 'fadeInUp 0.8s ease-out forwards';
              }
            }, parseInt(delay));
            
            observer.unobserve(element);
          }
        }
      });
    }, {
      threshold: 0.3
    });

    // Solo observar elementos que no sean timeline-item y eliminar atributos data-aos de timeline-items
    document.querySelectorAll('[data-aos]').forEach((item) => {
      if (item.classList.contains('timeline-item')) {
        // Remover atributos de animación de timeline-items
        item.removeAttribute('data-aos');
        item.removeAttribute('data-aos-delay');
        // Asegurar que estén completamente visibles y estáticos
        const element = item as HTMLElement;
        element.style.opacity = '1';
        element.style.transform = 'translateY(0)';
        element.style.animation = 'none';
      } else {
        observer.observe(item);
      }
    });

    // Función para animar hasta un punto específico
    const animateToPoint = (pointIndex: number) => {
      if (isAnimating || pointIndex === currentActivePoint) return;
      
      isAnimating = true;
      const targetItem = timelineItems[pointIndex];
      const targetMarker = targetItem?.querySelector('.timeline-marker') as HTMLElement;
      
      if (!targetItem || !targetMarker || !timeline || !timelineProgress) {
        isAnimating = false;
        return;
      }
      
      // Calcular posición del marcador específicamente
      const timelineRect = timeline.getBoundingClientRect();
      const timelineTop = timelineRect.top + window.scrollY;
      const markerRect = targetMarker.getBoundingClientRect();
      const markerTop = markerRect.top + window.scrollY;
      const markerCenter = markerTop + (markerRect.height / 2);
      
      // Calcular progreso hasta el centro del marcador
      const relativePosition = markerCenter - timelineTop;
      const progressPercentage = Math.min(100, Math.max(0, (relativePosition / timelineRect.height) * 100));
      
      // Animar la línea hasta el marcador
      timelineProgress.style.transition = 'height 0.8s cubic-bezier(0.4, 0, 0.2, 1)';
      timelineProgress.style.height = `${progressPercentage}%`;
      
      // Actualizar marcadores
      markers.forEach((marker, index) => {
        const markerElement = marker as HTMLElement;
        if (index <= pointIndex) {
          markerElement.classList.add('activated');
          // Efecto de chispas solo en el nuevo marcador
          if (index === pointIndex && index > currentActivePoint) {
            markerElement.classList.add('spark-effect');
            setTimeout(() => {
              markerElement.classList.remove('spark-effect');
            }, 800);
          }
        } else {
          markerElement.classList.remove('activated', 'spark-effect');
        }
      });
      
      // Actualizar contenidos e imágenes
      timelineItems.forEach((item, index) => {
        const content = item.querySelector('.timeline-content') as HTMLElement;
        const singleImage = item.querySelector('.timeline-single-image') as HTMLElement;
        const imageGroup = item.querySelector('.timeline-image-group') as HTMLElement;
        
        if (content) {
          if (index === pointIndex) {
            content.classList.add('highlighted');
          } else {
            content.classList.remove('highlighted');
          }
        }
        
        // Animar aparición de imágenes únicas (cards 1-2)
        if (singleImage) {
          if (index <= pointIndex) {
            const imageDelay = (index - Math.max(0, currentActivePoint)) * 150; // Reducido de 200 a 150ms
            setTimeout(() => {
              singleImage.classList.add('visible');
            }, Math.max(0, imageDelay));
          } else {
            singleImage.classList.remove('visible');
          }
        }
        
        // Animar aparición de grupos de imágenes (cards 3-4)
        if (imageGroup) {
          if (index <= pointIndex) {
            const imageDelay = (index - Math.max(0, currentActivePoint)) * 150; // Reducido de 200 a 150ms
            setTimeout(() => {
              imageGroup.classList.add('visible');
            }, Math.max(0, imageDelay));
          } else {
            imageGroup.classList.remove('visible');
          }
        }
      });
      
      currentActivePoint = pointIndex;
      
      setTimeout(() => {
        isAnimating = false;
      }, 600); // Reducido de 800 a 600ms para mayor responsividad
    };

    // Detectar qué punto debe estar activo basado en el scroll
    const updateTimelineProgress = () => {
      if (isAnimating || !timeline || timelineItems.length === 0) return;
      
      // Determinar qué marcador está más centrado en la pantalla
      let targetPoint = -1;
      let minDistance = Infinity;
      
      timelineItems.forEach((item, index) => {
        const marker = item.querySelector('.timeline-marker') as HTMLElement;
        if (!marker) return;
        
        const markerRect = marker.getBoundingClientRect();
        const markerCenter = markerRect.top + markerRect.height / 2;
        // Ajustar el centro de referencia más arriba para activación anticipada
        const screenCenter = window.innerHeight * 0.4; // Cambiado de 0.5 a 0.4 para que active antes
        const distance = Math.abs(markerCenter - screenCenter);
        
        // Solo considerar marcadores que están visibles
        const isVisible = markerRect.top < window.innerHeight && markerRect.bottom > 0;
        
        if (isVisible && distance < minDistance) {
          minDistance = distance;
          // Solo activar si el marcador está suficientemente centrado - UMBRAL REDUCIDO para activación más temprana
          if (distance < window.innerHeight * 0.45) { // Cambiado de 0.3 a 0.45 para que active antes
            targetPoint = index;
          }
        }
      });
      
      // Si estamos muy arriba de la timeline, no activar ningún punto - UMBRAL REDUCIDO para inicio más temprano
      const timelineRect = timeline.getBoundingClientRect();
      if (timelineRect.top > window.innerHeight * 0.75) { // Cambiado de 0.6 a 0.75 para que comience antes
        targetPoint = -1;
      }
      
      // Si hay un cambio de punto, animar
      if (targetPoint !== currentActivePoint && targetPoint >= -1) {
        if (targetPoint === -1) {
          // Reset - volver al inicio
          if (!isAnimating) {
            isAnimating = true;
            timelineProgress.style.transition = 'height 0.5s ease-out';
            timelineProgress.style.height = '0%';
            
            markers.forEach((marker) => {
              (marker as HTMLElement).classList.remove('activated', 'spark-effect');
            });
            
            timelineItems.forEach((item) => {
              const content = item.querySelector('.timeline-content') as HTMLElement;
              const singleImage = item.querySelector('.timeline-single-image') as HTMLElement;
              const imageGroup = item.querySelector('.timeline-image-group') as HTMLElement;
              
              if (content) content.classList.remove('highlighted');
              if (singleImage) singleImage.classList.remove('visible');
              if (imageGroup) imageGroup.classList.remove('visible');
            });
            
            currentActivePoint = -1;
            setTimeout(() => { isAnimating = false; }, 500);
          }
        } else {
          animateToPoint(targetPoint);
        }
      }
    };

    // Calcular la altura de las líneas para que terminen en el último círculo
    const calculateTimelineHeight = () => {
      const timeline = document.querySelector('.timeline') as HTMLElement;
      const lastMarker = document.querySelector('.timeline-item:last-child .timeline-marker') as HTMLElement;
      const timelineLineBase = document.querySelector('.timeline-line-base') as HTMLElement;
      const timelineLineProgress = document.querySelector('.timeline-line-progress') as HTMLElement;
      
      if (timeline && lastMarker && timelineLineBase && timelineLineProgress) {
        const timelineRect = timeline.getBoundingClientRect();
        const lastMarkerRect = lastMarker.getBoundingClientRect();
        
        // Calcular la posición relativa del último marcador
        const timelineTop = timeline.offsetTop;
        const lastMarkerTop = lastMarker.offsetTop + (lastMarker.offsetHeight / 2);
        const relativeHeight = lastMarkerTop - timelineTop;
        
        // Establecer la altura de las líneas
        timelineLineBase.style.height = `${relativeHeight}px`;
        timelineLineBase.style.bottom = 'auto';
        
        // La línea de progreso ya se maneja en updateTimelineProgress
      }
    };

    // Event listeners con throttling optimizado
    let scrollTimeout: ReturnType<typeof setTimeout> | null = null;
    const throttledUpdate = () => {
      if (scrollTimeout) return;
      
      scrollTimeout = setTimeout(() => {
        updateTimelineProgress();
        scrollTimeout = null;
      }, 8); // Reducido de 16 a 8ms para mayor responsividad (~120fps)
    };

    window.addEventListener('scroll', throttledUpdate);
    window.addEventListener('resize', () => {
      // Reset completo en resize
      currentActivePoint = -1;
      isAnimating = false;
      setTimeout(() => {
        calculateTimelineHeight();
        updateTimelineProgress();
      }, 100);
    });
    
    // Inicialización
    setTimeout(() => {
      updateTimelineProgress();
      calculateTimelineHeight();
    }, 1000);
  });
</script>
